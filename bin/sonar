#!/bin/bash
SONAR_SCANNER_CLI_VERSION=3.2.0.1227 \
    SONAR_SCANNER_HOME=/opt/sonar-scanner

apt-get update \
  && apt-get -y install \
     unzip \
  && rm -rf /var/lib/apt/lists/*

cd /opt \
  && curl -o sonar-scanner.zip -fSL https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-$SONAR_SCANNER_CLI_VERSION-linux.zip \
  && unzip sonar-scanner.zip \
  && mv sonar-scanner-$SONAR_SCANNER_CLI_VERSION-linux sonar-scanner \
  && rm sonar-scanner.zip*

buildkite-agent artifact download coverage/lcov.info coverage/ --build ${BUILDKITE_BUILD_ID}

/usr/bin/python submodules/sonar_js_generic_coverage/sonar_js_generic_coverage.py coverage/

sonar-scanner
